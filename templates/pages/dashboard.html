{{ define "title" }}Dashboard - Caddyshack{{ end }}

{{ define "content" }}
<div>
    <h2 class="text-2xl font-bold text-gray-800 mb-6">Dashboard</h2>
    <p class="text-gray-600 mb-8">Welcome to Caddyshack. Manage your Caddy server configuration from here.</p>

    <!-- Dashboard Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <!-- Sites Card -->
        <a href="/sites" class="block bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-gray-800">Sites</h3>
                <svg class="w-8 h-8 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"/>
                </svg>
            </div>
            <p class="text-3xl font-bold text-gray-900 mb-2">{{ .Data.SiteCount }}</p>
            <p class="text-sm text-gray-500">Configured sites</p>
        </a>

        <!-- Snippets Card -->
        <a href="/snippets" class="block bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-gray-800">Snippets</h3>
                <svg class="w-8 h-8 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/>
                </svg>
            </div>
            <p class="text-3xl font-bold text-gray-900 mb-2">{{ .Data.SnippetCount }}</p>
            <p class="text-sm text-gray-500">Reusable config blocks</p>
        </a>

        <!-- Certificates Card -->
        <div id="certificates-widget" hx-get="/certificates/widget" hx-trigger="load, every 30s" hx-swap="innerHTML">
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-800">Certificates</h3>
                    <a href="/certificates" class="text-blue-600 hover:text-blue-800 text-sm">View All</a>
                </div>
                <div class="space-y-2">
                    <div class="skeleton h-4 rounded w-full"></div>
                    <div class="skeleton h-4 rounded w-3/4"></div>
                    <div class="skeleton h-4 rounded w-1/2"></div>
                </div>
            </div>
        </div>

        <!-- Status Card -->
        <div class="bg-white rounded-lg shadow-md p-6 relative">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-gray-800">Caddy Status</h3>
                <svg class="w-8 h-8 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
            </div>
            <!-- Status Widget with HTMX polling -->
            <div id="caddy-status" hx-get="/status" hx-trigger="every 30s" hx-swap="outerHTML" hx-indicator="#status-loading">
                <!-- Loading indicator shown during refresh -->
                <div id="status-loading" class="htmx-indicator absolute top-4 right-4">
                    <svg class="animate-spin h-4 w-4 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
                    </svg>
                </div>

                <div class="flex items-center mb-3">
                    {{ if .Data.CaddyStatus.Running }}
                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800">
                        <span class="w-2 h-2 mr-2 bg-green-500 rounded-full animate-pulse"></span>
                        Running
                    </span>
                    {{ else }}
                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-red-100 text-red-800">
                        <span class="w-2 h-2 mr-2 bg-red-500 rounded-full"></span>
                        Not Connected
                    </span>
                    {{ end }}
                </div>

                {{ if .Data.CaddyStatus.Running }}
                <div class="space-y-2 text-sm text-gray-600">
                    {{ if .Data.CaddyStatus.Version }}
                    <div class="flex items-center">
                        <span class="text-gray-500 w-16">Version:</span>
                        <span class="font-mono text-gray-700">{{ .Data.CaddyStatus.Version }}</span>
                    </div>
                    {{ end }}
                    {{ if .Data.CaddyStatus.Uptime }}
                    <div class="flex items-center">
                        <span class="text-gray-500 w-16">Uptime:</span>
                        <span class="font-mono text-gray-700">{{ .Data.CaddyStatus.Uptime }}</span>
                    </div>
                    {{ end }}
                </div>
                {{ else }}
                <p class="text-sm text-gray-500 mt-2">Unable to connect to Caddy Admin API</p>
                {{ end }}
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="mt-8">
        <h3 class="text-lg font-semibold text-gray-800 mb-4">Quick Actions</h3>
        <div class="flex flex-wrap gap-4">
            <a href="/sites/new" class="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                </svg>
                Add Site
            </a>
            <a href="/history" class="inline-flex items-center px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition-colors">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                View History
            </a>
        </div>
    </div>

    <!-- Export Section -->
    <div class="mt-8">
        <h3 class="text-lg font-semibold text-gray-800 mb-4">Export Configuration</h3>
        <div class="flex flex-wrap gap-4">
            <a href="/export" class="inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                </svg>
                Export Caddyfile
            </a>
            <a href="/export/json" class="inline-flex items-center px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition-colors">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                </svg>
                Export JSON Config
            </a>
            <a href="/export/backup" class="inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition-colors">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"/>
                </svg>
                Full Backup (ZIP)
            </a>
        </div>
    </div>
</div>
{{ end }}

{{ template "base" . }}
